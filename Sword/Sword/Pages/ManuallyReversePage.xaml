<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Sword.ManuallyReversePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Sword"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:community="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d"
    Background="Transparent">

    <Grid>
        <!-- 定义行 -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 定义列 -->
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.6*"/>
            <ColumnDefinition Width="auto"/>
        </Grid.ColumnDefinitions>

        <!-- 顶部菜单 -->
        <MenuBar Grid.Row="0" Grid.Column="0" Margin="10,5,0,0">
            <MenuBarItem x:Name="Menu_File">
                <MenuFlyoutItem x:Name="Menu_OpenPluginsFolder"  Click="Menu_OpenPluginsFolder_Click" />
                <MenuFlyoutItem x:Name="Menu_OpenLogsFolder"  Click="Menu_OpenLogsFolder_Click"/>
                <MenuFlyoutItem x:Name="Menu_OpenLatestLogFile"  Click="Menu_OpenLatestLogFile_Click"/>
                <MenuFlyoutItem x:Name="Menu_OpenConfigsFolder" Click="Menu_OpenConfigsFolder_Click"/>
                <MenuFlyoutItem x:Name="Menu_GameTypeFolder"  Click="Menu_GameTypeFolder_Click"/>
                <MenuFlyoutItem x:Name="Menu_ReversedFolder" Click="Menu_ReversedFolder_Click"/>
            </MenuBarItem>
   

            <MenuBarItem x:Name="Menu_Textures">
                <MenuFlyoutItem x:Name="Menu_Textures_ConvertJpg" Click="Menu_Textures_ConvertJpg_Click"/>
                <MenuFlyoutItem x:Name="Menu_Textures_ConvertPng" Click="Menu_Textures_ConvertPng_Click"/>
                <MenuFlyoutItem x:Name="Menu_Textures_ConvertTga"  Click="Menu_Textures_ConvertTga_Click"/>
            </MenuBarItem>

            <MenuBarItem x:Name="Menu_ManuallyReverseList">
                <MenuFlyoutItem x:Name="Menu_ManuallyReverseList_SaveCurrentList" Click="Menu_ManuallyReverseList_SaveCurrentList_Click"></MenuFlyoutItem>
                <MenuFlyoutItem x:Name="Menu_ManuallyReverseList_ReadListFromConfig" Click="Menu_ManuallyReverseList_ReadListFromConfig_Click"></MenuFlyoutItem>
            </MenuBarItem>
        </MenuBar>

        <ScrollViewer
            Grid.Row="1"
            Grid.Column="1"
            >
            <StackPanel
            Margin="5"
            Orientation="Vertical"
            >

     

                <ComboBox
                x:Name="ComboBox_GameTypeName"
                Margin="5"
                Width="200"
                >
                </ComboBox>

                <Button 
                Click="Button_ClearAllList_Click"
                x:Name="Button_ClearAllList"
                Margin="5"/>

                <Button
                Style="{StaticResource AccentButtonStyle}"
                Margin="5"
                x:Name="Button_ExecuteManuallyReverse"
                Click="Button_ManuallyReverseModel_Click"
                />

                <MenuFlyoutSeparator Margin="5"></MenuFlyoutSeparator>

                <CheckBox
                IsChecked="True"
                Margin="5"
                x:Name="CheckBox_AutoConvertTexturesRecursively"
                />

                <CheckBox
                IsChecked="True"
                Margin="5"
                x:Name="CheckBox_AutoOpenFolderAfterReverse"
                />

                <CheckBox
                IsChecked="True"
                Margin="5"
                x:Name="CheckBox_AutoConvertTexturesRecursivelyInOriginalModFolder"
                />

            </StackPanel>

        </ScrollViewer>




        <!-- 支持滑条，不然显示不完全 -->
        <ScrollViewer 
        Margin="20"
        Grid.RowSpan="2"
        Grid.Column="0"
        Grid.Row="1"
        VerticalScrollBarVisibility="Auto" >

            <StackPanel Orientation="Vertical">

                <Expander
                HorizontalContentAlignment="Stretch"
                HorizontalAlignment="Stretch"
                IsExpanded="True">
                    <Expander.Header>
                        <StackPanel Margin="10">
                            <TextBlock 
                            x:Name="TextBlock_IndexBufferFileList"
                            FontSize="14" 
                            FontWeight="Bold"/>
                        </StackPanel>
                    </Expander.Header>


                    <StackPanel Orientation="Vertical">
                        <community:DataGrid 
                        AutoGenerateColumns="False"  
                        Height="Auto"
                        MinHeight="160"
                        x:Name="DataGrid_IBFile"  
                        HorizontalAlignment="Stretch" 
                        ItemsSource="{x:Bind IndexBufferItemList}"
                        AllowDrop="True"
                        DragOver="DataGrid_IBFile_DragOver"
                        Drop="DataGrid_IBFile_Drop"
                        >

                            <community:DataGrid.ContextFlyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem 
                                    x:Name="Menu_DeleteIBFilePath" 
                                    Click="Menu_DeleteIBFilePath_Click"></MenuFlyoutItem>
                                </MenuFlyout>
                            </community:DataGrid.ContextFlyout>

                            <community:DataGrid.Columns>
                                <community:DataGridTextColumn 
                                x:Name="DataGridTextColumn_IB_Format"
                                Width="250"  
                                Binding="{Binding Format}" 
                                IsReadOnly="False"/>
                                <community:DataGridTextColumn 
                                x:Name="DataGridTextColumn_IB_FilePath"
                                Width="636"  
                                Binding="{Binding IBFilePath}" 
                                IsReadOnly="False"/>
                            </community:DataGrid.Columns>
                        </community:DataGrid>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock 
                            x:Name="TextBlock_IndexBufferFilePath"
                            VerticalAlignment="Center" 
                            Margin="5">
                            </TextBlock>
                            <TextBox 
                            x:Name="TextBox_IBBufFilePath" 
                            Width="500" 
                            Margin="5" 
                            DragOver="TextBox_IBBufFilePath_DragOver" 
                            AllowDrop="True" 
                            Drop="TextBox_IBBufFilePath_Drop">
                            </TextBox>
                            <Button 
                            Margin="5"
                            x:Name="Button_ChooseIBBufFile" 
                            Click="Button_ChooseIBBufFile_Click">
                            </Button>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock 
                            x:Name="TextBlock_IndexBufferFormat"
                            VerticalAlignment="Center" 
                            Margin="5">
                            </TextBlock>
                            <ComboBox 
                            x:Name="ComboBox_IBFormat" 
                            Margin="5" 
                            Width="230" 
                            IsEditable="True">
                                <ComboBoxItem>DXGI_FORMAT_R32_UINT</ComboBoxItem>
                                <ComboBoxItem>DXGI_FORMAT_R16_UINT</ComboBoxItem>
                            </ComboBox>
                            <Button 
                            Margin="5"
                            x:Name="Button_AddToIndexBufferList" 
                            HorizontalAlignment="Center" 
                            Click="Button_AddToIndexBufferList_Click" 
                            >
                            </Button>
                        </StackPanel>


                    </StackPanel>

                </Expander>

                <Expander
                HorizontalContentAlignment="Stretch"
                HorizontalAlignment="Stretch"
                IsExpanded="True">
                    <Expander.Header>
                        <StackPanel Margin="10">
                            <TextBlock 
                            x:Name="TextBlock_CategoryBufferFileList"
                            FontSize="14" 
                            FontWeight="Bold"/>
                        </StackPanel>
                    </Expander.Header>

                    <StackPanel Orientation="Vertical">
                        <community:DataGrid 
                        AutoGenerateColumns="False"  
                        MinHeight="200"
                        Height="Auto"
                        x:Name="DataGrid_CategoryBufferFile"  
                        HorizontalAlignment="Stretch" 
                        ItemsSource="{x:Bind CategoryBufferItemList}"
                        DragOver="DataGrid_CategoryBufferFile_DragOver"
                        Drop="DataGrid_CategoryBufferFile_Drop"
                        AllowDrop="True">

                            <community:DataGrid.ContextFlyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem 
                                    x:Name="Menu_DeleteCategoryBufFilePath" 
                                    Click="Menu_DeleteCategoryBufFilePath_Click"></MenuFlyoutItem>
                                </MenuFlyout>
                            </community:DataGrid.ContextFlyout>

                            <!--CellEditEnding="MyDataGrid_CellEditEnding"-->
                            <community:DataGrid.Columns>
                                <community:DataGridTextColumn 
                                x:Name="DataGridTextColumn_CategoryBuffer_Category"
                                Width="200"  
                                Binding="{Binding Category}" 
                                IsReadOnly="False"/>
                                <community:DataGridTextColumn 
                                x:Name="DataGridTextColumn_CategoryBuffer_FilePath"
                                Width="666"  
                                Binding="{Binding BufFilePath}" 
                                IsReadOnly="False"/>
                            </community:DataGrid.Columns>
                        </community:DataGrid>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock 
                            x:Name="TextBlock_CategoryBuffer_FilePath"
                            VerticalAlignment="Center" 
                            Margin="5"></TextBlock>
                            <TextBox 
                            x:Name="TextBox_CategoryBufferFilePath" 
                            Width="500" 
                            Margin="5"
                            AllowDrop="True"
                            DragOver="TextBox_CategoryBufferFilePath_DragOver"
                            Drop="TextBox_CategoryBufferFilePath_Drop">
                            </TextBox>

                            <Button 
                            Margin="5"
                            x:Name="Button_ChooseCategoryBufferFile" 
                            Click="Button_ChooseCategoryBufferFile_Click"></Button>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock 
                            x:Name="TextBlock_CategoryBuffer_Category"
                            VerticalAlignment="Center" 
                            Margin="5"></TextBlock>
                            <ComboBox 
                            x:Name="ComboBox_Category" 
                            Margin="5" 
                            Width="160" 
                            IsEditable="True">
                                <ComboBoxItem>Position</ComboBoxItem>
                                <ComboBoxItem>Texcoord</ComboBoxItem>
                                <ComboBoxItem>Blend</ComboBoxItem>
                            </ComboBox>
                            <Button 
                            x:Name="Button_AddToCategoryBufferList" 
                            HorizontalAlignment="Center" 
                            Margin="5" 
                            Click="Button_AddToCategoryBufferList_Click"></Button>
                        </StackPanel>

                    </StackPanel>

                </Expander>


                <Expander
                HorizontalContentAlignment="Stretch"
                HorizontalAlignment="Stretch"
                IsExpanded="True">
                    <Expander.Header>
                        <StackPanel Margin="10">
                            <TextBlock 
                            x:Name="TextBlock_ShapeKeyPositionBufferFileList"
                            FontSize="14" 
                            FontWeight="Bold"/>
                        </StackPanel>
                    </Expander.Header>

                    <StackPanel Orientation="Vertical">
                        <community:DataGrid 
                        AutoGenerateColumns="False"  
                        MinHeight="200"
                        Height="Auto"
                        x:Name="DataGrid_ShapeKeyPositionBufferFile"  
                        HorizontalAlignment="Stretch" 
                        ItemsSource="{x:Bind ShapeKeyPositionBufferItemList}"
                        DragOver="DataGrid_ShapeKeyPositionBufferFile_DragOver"
                        Drop="DataGrid_ShapeKeyPositionBufferFile_Drop"
                        AllowDrop="True">


                            <community:DataGrid.ContextFlyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem 
                                    Click="Menu_DeleteShapeKeyPositionBufFilePath_Click"
                                    x:Name="Menu_DeleteShapeKeyPositionBufFilePath" 
                                    ></MenuFlyoutItem>
                                </MenuFlyout>
                            </community:DataGrid.ContextFlyout>

                            <!--CellEditEnding="MyDataGrid_CellEditEnding"-->
                            <community:DataGrid.Columns>
                                <community:DataGridTextColumn 
                                x:Name="DataGridTextColumn_ShapeKeyPositionBuffer_Category"
                                Width="200"  
                                Binding="{Binding Category}" 
                                IsReadOnly="False"/>
                                <community:DataGridTextColumn 
                                x:Name="DataGridTextColumn_ShapeKeyPositionBuffer_FilePath"
                                Width="666"  
                                Binding="{Binding BufFilePath}" 
                                IsReadOnly="False"/>
                            </community:DataGrid.Columns>
                        </community:DataGrid>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock 
                            x:Name="TextBlock_ShapeKeyPositionBuffer_FilePath"
                            VerticalAlignment="Center" 
                            Margin="5"/>
                            <TextBox 
                            x:Name="TextBox_ShapeKeyPositionBufferFilePath" 
                            Width="500" 
                            Margin="5"
                            AllowDrop="True"
                            DragOver="TextBox_ShapeKeyPositionBufferFilePath_DragOver"
                            Drop="TextBox_ShapeKeyPositionBufferFilePath_Drop"
                            />


                        </StackPanel>

                        <Button 
                        HorizontalAlignment="Center"
                        Margin="5"
                        x:Name="Button_ChooseShapeKeyPositionBufferFile" 
                        Click="Button_ChooseShapeKeyPositionBufferFile_Click"
                        />

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock 
                            x:Name="TextBlock_ShapeKeyPositionBuffer_Category"
                            VerticalAlignment="Center" 
                            Margin="5"></TextBlock>
                            <ComboBox 
                            x:Name="ComboBox_ShapeKeyPositionCategory" 
                            Margin="5" 
                            Width="160" 
                            IsEditable="True">
                                <ComboBoxItem>ShapeKey001</ComboBoxItem>
                                <ComboBoxItem>ShapeKey002</ComboBoxItem>
                                <ComboBoxItem>ShapeKey003</ComboBoxItem>
                            </ComboBox>
                            <Button 
                            x:Name="Button_AddToShapeKeyPositionBufferList" 
                            HorizontalAlignment="Center" 
                            Margin="5" 
                            Click="Button_AddToShapeKeyPositionBufferList_Click"
                            />
                        </StackPanel>

                    </StackPanel>

                </Expander>

            </StackPanel>

        </ScrollViewer>

    </Grid>
    
</Page>
